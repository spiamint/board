<!DOCTYPE html>
<!--타임리프 및 스프링 시큐리티 확장 네임스페이스 사용-->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>게시판</title>
    <style>



        /*h1 {*/
        /*    font-size: 3em;*/
        /*    text-align: center;*/
        /*    font-weight: bold;*/
        /*    margin-top: 50px;*/
        /*}*/

        #container {
            padding-top: 10px;
        }

        #headerText {
            text-indent: 1em;
            font-size: 1.7em;
        }

        #noneContent {
            margin: 0 auto;
            text-align: center;
            font-size: 20px;
        }

        #noneContent p {
            padding: 30px;
        }

        #write::after {display: block; content: none; clear: both}

        #write > button {
            float: right;
        }

        #content .category-label {
            color: grey;
        }

        #content table a{
            text-decoration: none;
            color: black;
        }

        #content a:hover {
            color: #0d6efd;
            text-decoration: underline;
        }

        #content .active a:hover {
            color: white;
        }

        #searchForm {
            max-width: 540px;
        }

        #searchForm #searchKeyword, #searchForm #searchOption, #searchForm button {
            display: inline-block;
        }

        #searchForm #searchKeyword {
            width: 55%;
        }

        #searchForm #searchOption {
            width: 25%;
        }

        #searchForm button {
            width: 15%;
            height: 100%;
            vertical-align: inherit;
        }

    </style>
    <script src="http://code.jquery.com/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
          rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
          crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" th:href="@{/css/nav-css.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/global.css}" href="/static/css/global.css">
    <script>
        $(document).ready(function () {
            let searchForm = $("#searchForm");

            $("#searchForm>button").on("click", function (event) {
                event.preventDefault();

                // option 확인 .find("selector")
                // 0, -0, null, false, NaN, undefined, "" 을 제외한 모든 값은 true 다 (비어있지 않은 객체 포함)
                if (!searchForm.find("option:selected").val()) {
                    alert("검색종류를 선택하세요");
                    return false;
                }

                // keyword 확인
                if (!searchForm.find("input[name='keyword']").val()) {
                    alert("키워드를 입력하세요");
                    return false;
                }

                searchForm.submit();
            })

            // 페이지네이션 액티브를 위한 변수
            let currentPage = $("#pageInfo>input:first-child").attr("value");
            let startNum = $(".page-link-number:first-child").attr("data-pagenum");
            // console.log("curentPage = " + currentPage + " startNum = " + startNum)

            // 페이지네이션 액티브
            if(currentPage != null) {
                $(".page-item-number").each(function () {
                    if (startNum == currentPage) {
                        $(this).attr("class", "page-item page-item-number active");
                    }
                    startNum++;
                })
            }

            // 검색중일때 .page-link.onclick, option 은 검색하면 criteria.option 으로 자동으로 들어감
            $(".page-link").on("click", function (event) {

                let option = $("#pageInfo>input[name = 'option']").val();

                if (option == null || option == "") {
                    // option 없음 = 원래이벤트
                    location.href = event.target.href;
                    return false;
                }

                $("#pageInfo>input:first-child").attr("value", $(this).attr("data-pagenum"));
                $("#pageInfo").submit();
                return false;
            })
        })
    </script>
    <script th:inline="javascript">
        // /*<![CDATA[*/

        /*]]>*/
    </script>
</head>

<!-- fixedTop nav 랑 안겹치게 하는 클래스 옵션 pt-5 로 padding-top 5 주면 되는데 더 높게하려면
        따로 지정해줘야 되는거 같아서 그냥 nav-css 에다가 60px 로 선언함-->
<!--<body class="pt-5">-->
<body id="body">
<div id="container" class="container">

    <nav th:replace="fragment/fragment.html :: nav-fragment">
    </nav>

    <div id="header">
        <h2 id="headerText" th:text="${criteria.category.getCategoryName() + ' 게시판'}">게시판</h2>
    </div>

    <hr>

    <div id="noneContent" th:if="${boardList.isEmpty()}">
        <p>
        <h3> 조회 결과가 없습니다. </h3>
        </p>
    </div>

    <div id="content" th:if="${!boardList.isEmpty()}">
        <table id="listTable" class="table">
            <colgroup>
                <col width="7%">
                <col width="41%">
                <col width="15%">
                <col width="15%">
                <col width="15%">
                <col width="7%">
            </colgroup>

            <thead>
            <tr>
                <th>번호</th>
                <th>제목</th>
                <th>작성자</th>
                <th>작성시각</th>
                <th>수정시각</th>
                <th>조회</th>
            </tr>
            </thead>
            <tbody>
            <!-- BoardController.pagedList() 에서 Model 객체에 "pageMaker" 바인딩하여 전달됨 -->
            <tr th:each="item : ${boardList}"
                th:with="currentPage=${param.currentPage == null} ? 1 : ${param.currentPage}">
                <!-- totalCount - cri.contentPerPage * (currentPage - 1) - i -->
                <td id="boardNum" th:text="${pageMaker.totalCount - criteria.contentPerPage * (pageMaker.currentPage - 1) - itemStat.index}">id</td>
                <!--검색안함-->
                <td th:if="${criteria.option == null}">
                    <!-- if(Category == ALL) categoryCode = "" ;-->
                    <span class="category-label" th:if="${pageMaker.categoryCode == 'all'}" th:text="${'[' + item.category.getCategoryName() + ']'}"></span>
                    <a id="readLink" href="list.html"
                       th:href="@{|/board/read/${pageMaker.categoryCode}/${item.id}?currentPage=${currentPage}|}"
                       th:text="${item.title}">title</a>
                </td>
                <!--검색중-->
                <td th:if="${criteria.option != null}">
                    <span class="category-label" th:if="${pageMaker.categoryCode == 'all'}" th:text="${'[' + item.category.getCategoryName() + ']'}"></span>
                    <a id="readLink2" href="list.html"
                       th:href="@{|/board/read/${pageMaker.categoryCode}/${item.id}?currentPage=${currentPage}&option=${criteria.option}&keyword=${criteria.keyword}|}"
                       th:text="${item.title}">title</a>
                </td>
                <td th:text="${item.writer}">writer</td>

                <td th:if="${item.isToday(item.regedate)}" th:text="${#temporals.format(item.regedate, 'HH:mm')}">regdate</td>
                <td th:if="${!item.isToday(item.regedate)}" th:text="${#temporals.format(item.regedate, 'yy-MM-dd')}">regdate</td>

                <td th:if="${item.isToday(item.updateDate)}" th:text="${#temporals.format(item.updateDate, 'HH:mm')}">updateDAte</td>
                <td th:if="${!item.isToday(item.updateDate)}" th:text="${#temporals.format(item.updateDate, 'yy-MM-dd')}">updateDate</td>

                <td th:text="${item.viewCount}"> 조회수</td>
            </tr>
            </tbody>
        </table>


    <!-- a 태그들의 th:href 는 검색중이 아닐때만 사용, 검색중일때는 자바스크립트 사용 (if selectOption != none) -->
    <!-- pagination -->
    <div class="container">
        <ul class="pagination col justify-content-center" id="paginationContainer">
            <li class="page-item" th:if="${pageMaker.isPrevBt}">
                <a th:href="@{|/board/list/${pageMaker.getCategoryCode()}?currentPage=${(pageMaker.startPageNum)-1}|}"
                   th:data-pageNum="${(pageMaker.startPageNum)-1}" class="page-link">&laquo;</a>
            </li>
            <!-- ${#numbers.sequence(from,to,[step])} 단순반복 numbers 유틸리티 클래스 배열 생성후 사용 -->
            <!--    <li th:each="num : ${#numbers.sequence(${pageMaker.startPageNum},${pageMaker.endPageNum})}">-->
            <li class="page-item page-item-number" th:each="num : ${#numbers.sequence(pageMaker.startPageNum, pageMaker.endPageNum)}">
                <a th:href="@{|/board/list/${pageMaker.getCategoryCode()}?currentPage=${num}|}" th:text="${num}" th:data-pagenum="${num}"
                   class="page-link page-link-number"> 페이지번호 </a>
            </li>
            <li class="page-item" th:if="${pageMaker.isNextBt()}">
                <a th:href="@{|/board/list/${pageMaker.getCategoryCode()}?currentPage=${pageMaker.endPageNum+1}|}"
                   th:data-pageNum="${pageMaker.endPageNum+1}" class="page-link">&raquo;</a>
            </li>
        </ul>
    </div>
    </div>

    <!-- 글쓰기 버튼 -->
    <div class="float-right" id="write">
        <button type="button" class="btn btn-primary" th:if="${criteria.categoryCode.equals('notice')}" sec:authorize="hasRole('ROLE_ADMIN')"
                th:onclick="|location.href='@{/board/write/{categoryCode}(categoryCode=${criteria.getCategoryCode})}'|">글쓰기</button>
        <button type="button" class="btn btn-primary" th:unless="${criteria.categoryCode.equals('notice')}"
                th:onclick="|location.href='@{/board/write/{categoryCode}(categoryCode=${criteria.getCategoryCode})}'|">글쓰기</button>
    </div>

    <!-- 검색창 -->
    <div class="row justify-content-center input-group" style="clear:right;width:500px;margin:auto">
        <!-- th:action 태그는 javascript 를 통해 submit 할떄 적용되지 않는 것으로 보임 -->
        <!-- method = get 이므로 form 데이터가 queryString 에 붙어나감 -->
        <form id="searchForm" action="/board/list" method="get"
              th:action="@{|/board/list/${pageMaker.categoryCode}|}" th:object="${criteria}">
            <input type="hidden" name="currentPage" value="1">
            <select th:field="*{option}" name="option" class="form-select" id="searchOption">
                <option value="">전체보기</option>
                <option value="title">제목</option>
                <option value="content">내용</option>
            </select>
            <input id="searchKeyword" type="text" th:field="*{keyword}" name="keyword" class="form-control"/>
            <button class="btn btn-primary btn-sm">검색</button>
        </form>
    </div>

    <!-- 검색 및 현재페이지 정보 -->
    <form id="pageInfo" method="get">
        <input type="hidden" th:name="currentPage" th:value="${criteria.currentPage}">
        <input type="hidden" name="option" th:name="option" th:value="${criteria.option}">
        <input type="hidden" th:name="keyword" th:value="${criteria.keyword}">
    </form>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
</body>

<!-- 메모
url 이동 표현식례
th:href="@{/basic/items/{itemId(itemId=${item.id}, query='test')}"
생성 링크: http://localhost:8080/basic/items/1?query=test
-->
</html>